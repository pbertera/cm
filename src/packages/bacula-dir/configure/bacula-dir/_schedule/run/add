#!/bin/sh
# set ip in configuration database for device
# @param $1: bacula-dir: 	statical part of command
# @param $2: schedule: 		statical part of command
# @param $3: schedule-id:	statical part of command
# @param $4: run:		statical part of command
# @param $5: add:		the id of new run
# @param $6: run-id:		the id of new run

. ${__cm_lib_dir}/cmlib

command=$(__cm_command $@)
command_path=$(__cm_command_path $@)
param=$(__cm_command_param $@)
command_path_dir=$(__cm_command_path_dir $@)
command_name=$(__cm_command_name $@)

schedule_id=$3

if [ $__cm_no_command ]; then
	[ -L $__cm_configure_libexec_dir/bacula-dir/schedule/$schedule_id/run/$param ] || __cm_exit_error "Bacula schedule run $param not exist in schedule $schedule_id"
	__cm_db_remove_branch bacula-dir schedule $schedule_id run "$param"
	rm $__cm_configure_libexec_dir/bacula-dir/schedule/$schedule_id/run/$param
else
	[ -L $__cm_configure_libexec_dir/bacula-dir/schedule/$schedule_id/run/$param ] && __cm_exit_error "Bacula schedule run $param in schedule $param exist"
	ln -s ../_run $__cm_configure_libexec_dir/bacula-dir/schedule/$schedule_id/run/$param
	__cm_db_create_branch bacula-dir schedule $schedule_id run "$param" 
	__cm_db_set_leaf monthly bacula-dir schedule "$schedule_id" run "$param" monthspec
	__cm_db_set_leaf daily bacula-dir schedule "$schedule_id" run "$param" dayspec
	__cm_db_set_leaf hourly bacula-dir schedule "$schedule_id" run "$param" timespec
fi
